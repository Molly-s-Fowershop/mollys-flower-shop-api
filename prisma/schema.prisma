// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Clients

model User {
  id               Int                @id @default(autoincrement())
  email            String             @unique
  name             String
  lastname         String
  hashedPassword   String
  address          Address[]
  cart             Cart[]
  couponCodeUse    CouponCodeUse[]
  userNotification UserNotification[]

  updatedAt DateTime   @updatedAt
  createdAt DateTime   @default(now())
  wishList  Wishlist[]

  @@map("users")
}

model Address {
  id           Int         @id @default(autoincrement())
  userId       Int
  user         User        @relation(fields: [userId], references: [id])
  street       String
  streetNumber String
  city         String
  state        String
  postalCode   String
  country      String
  orderItem    OrderItem[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Inventory

model Product {
  id                        Int                         @id @default(autoincrement())
  name                      String
  description               String
  categoryId                Int
  category                  Category                    @relation(fields: [categoryId], references: [id])
  productCustomizationGroup ProductCustomizationGroup[]
  orderItem                 OrderItem[]
  cartItem                  CartItem[]
  offerProduct              OfferProduct[]
  mediaProduct              MediaProduct[]

  updatedAt    DateTime       @updatedAt
  createdAt    DateTime       @default(now())
  wishListItem WishlistItem[]
}

model Category {
  id            Int             @id @default(autoincrement())
  name          String
  description   String
  products      Product[]
  offerCategory OfferCategory[]
  mediaCategory MediaCategory[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Product Customization

model CustomizationGroup {
  id                        Int                         @id @default(autoincrement())
  name                      String
  customization             Customization[]
  productCustomizationGroup ProductCustomizationGroup[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model Customization {
  id                    Int                     @id @default(autoincrement())
  name                  String
  price                 Float
  customizationGroupId  Int
  customizationGroup    CustomizationGroup      @relation(fields: [customizationGroupId], references: [id])
  cartItemCustomization CartItemCustomization[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model ProductCustomizationGroup {
  id                   Int                @id @default(autoincrement())
  productId            Int
  product              Product            @relation(fields: [productId], references: [id])
  customizationGroupId Int
  customizationGroup   CustomizationGroup @relation(fields: [customizationGroupId], references: [id])

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Orders

model Order {
  id        Int         @id @default(autoincrement())
  userId    Int
  couponId  Int?
  orderItem OrderItem[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model OrderItem {
  id                Int      @id @default(autoincrement())
  orderId           Int
  order             Order    @relation(fields: [orderId], references: [id])
  productId         Int
  product           Product  @relation(fields: [productId], references: [id])
  quantity          Int
  deliverDate       DateTime
  deliverTime       String
  deliveryAddressId Int?
  deliveryAddress   Address? @relation(fields: [deliveryAddressId], references: [id])

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Carts

model Cart {
  id       Int        @id @default(autoincrement())
  userId   Int
  user     User       @relation(fields: [userId], references: [id])
  cartItem CartItem[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model CartItem {
  id                    Int                     @id @default(autoincrement())
  cartId                Int
  cart                  Cart                    @relation(fields: [cartId], references: [id])
  productId             Int
  product               Product                 @relation(fields: [productId], references: [id])
  quantity              Int
  cartItemCustomization CartItemCustomization[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model CartItemCustomization {
  id              Int           @id @default(autoincrement())
  cartItemId      Int
  cartItem        CartItem      @relation(fields: [cartItemId], references: [id])
  customizationId Int
  customization   Customization @relation(fields: [customizationId], references: [id])

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Offers and Coupons

enum DiscountType {
  PERCENTAGE
  AMOUNT
}

enum OfferContextType {
  PRODUCT
  CATEGORY
}

model Offer {
  id            Int              @id @default(autoincrement())
  name          String
  description   String
  maxUses       Int
  discountType  DiscountType
  discountValue Float
  isAvailable   Boolean
  startDate     DateTime
  endDate       DateTime
  offerContext  OfferContextType
  offerProduct  OfferProduct[]
  offerCategory OfferCategory[]
  couponCode    CouponCode[]
  mediaOffer    MediaOffer[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model OfferProduct {
  id        Int     @id @default(autoincrement())
  offerId   Int
  offer     Offer   @relation(fields: [offerId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model OfferCategory {
  id         Int      @id @default(autoincrement())
  offerId    Int
  offer      Offer    @relation(fields: [offerId], references: [id])
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model CouponCode {
  id            Int             @id @default(autoincrement())
  code          String
  description   String
  offerId       Int
  offer         Offer           @relation(fields: [offerId], references: [id])
  couponCodeUse CouponCodeUse[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

model CouponCodeUse {
  id       Int        @id @default(autoincrement())
  couponId Int
  coupon   CouponCode @relation(fields: [couponId], references: [id])
  userId   Int
  user     User       @relation(fields: [userId], references: [id])

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Media

enum MediaContextType {
  PRODUCT
  CATEGORY
  OFFER
  USER
}

model Media {
  id            Int              @id @default(autoincrement())
  url           String
  context       MediaContextType
  mediaProduct  MediaProduct[]
  mediaCategory MediaCategory[]
  mediaOffer    MediaOffer[]
}

model MediaProduct {
  id        Int     @id @default(autoincrement())
  mediaId   Int
  media     Media   @relation(fields: [mediaId], references: [id])
  productId Int
  product   Product @relation(fields: [productId], references: [id])
}

model MediaCategory {
  id         Int      @id @default(autoincrement())
  mediaId    Int
  media      Media    @relation(fields: [mediaId], references: [id])
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])
}

model MediaOffer {
  id      Int   @id @default(autoincrement())
  mediaId Int
  media   Media @relation(fields: [mediaId], references: [id])
  offerId Int
  offer   Offer @relation(fields: [offerId], references: [id])
}

// Notifications

enum NotificationType {
  ORDER
  OFFER
  COUPON
}

model Notification {
  id                    Int                     @id @default(autoincrement())
  title                 String
  content               String
  type                  NotificationType
  sentAt                DateTime
  userNotification      UserNotification[]
  broadcastNotification BroadcastNotification[]
}

model UserNotification {
  id             Int          @id @default(autoincrement())
  userId         Int
  user           User         @relation(fields: [userId], references: [id])
  notificationId Int
  notification   Notification @relation(fields: [notificationId], references: [id])
}

model BroadcastNotification {
  id             Int          @id @default(autoincrement())
  notificationId Int
  notification   Notification @relation(fields: [notificationId], references: [id])
  expiresAt      DateTime?

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
}

// Wishlist

model Wishlist {
  id     Int            @id @default(autoincrement())
  userId Int
  user   User           @relation(fields: [userId], references: [id])
  items  WishlistItem[]
}

model WishlistItem {
  wishlistId Int
  wishlist   Wishlist @relation(fields: [wishlistId], references: [id])
  product    Product  @relation(fields: [productId], references: [id])
  productId  Int

  @@id(name: "id", [wishlistId, productId])
}
